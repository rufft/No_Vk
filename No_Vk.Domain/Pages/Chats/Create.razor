@page "/chats/create"

@using No_Vk.Domain.Models.ViewModels
@using No_Vk.Domain.Services

@inject ILoggedInUserSessionService _loggedInUserSession
@inject IChatHandlerService _chatData

<form action="" method="post">

    <div>
        Введите имя чата
        <input @bind="_chatTarget.Name" />
    </div>
    <div>
        <br />
        Добавить друзей в чат
        <br />
        @foreach(var friend in _loggedInUserSession.Me.Friends)
        {
            @friend.FriendUser.UserName
            <input type="checkbox" @onchange="() => UpdateListOfUsers(friend.FriendUser)" />
            <br />
        }
    </div>
    <button type="submit" @onclick="Submit">Создать чат</button>
</form>

@code {
    private ChatBindingTarget _chatTarget;
    private List<User> _users;

    protected override void OnInitialized()
    {
        _chatTarget = new();
        _users = new() { _loggedInUserSession.Me };
    }


    private void Submit()
    {
        _chatData.CreateChatAsync(_chatTarget, _users.Select(u => u.Id).ToArray());
    }

    private void UpdateListOfUsers(User user)
    {
        if (_users.Contains(user))
        {
            _users.Remove(user);
        }
        else
        {
            _users.Add(user);
        }
    }

}
